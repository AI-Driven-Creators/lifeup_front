import{s as M,j as y,d as U,u as L,l as G,r as x,m as j,a as d,g as z,b as s,_ as V,f as p,t as o,i as h,h as l,F as b,e as v,w as H,v as K,p as N,n as X,o as g}from"./index-BETfxjSh.js";const O=M("skill",{state:()=>({skills:[],loading:!1,error:null}),getters:{technicalSkills:e=>e.skills.filter(a=>a.category==="technical"),softSkills:e=>e.skills.filter(a=>a.category==="soft"),skillsByLevel:e=>a=>e.skills.filter(t=>t.level===a),totalSkillExperience:e=>e.skills.reduce((a,t)=>a+t.experience,0),averageSkillLevel:e=>{if(e.skills.length===0)return 0;const a=e.skills.reduce((t,n)=>t+n.level,0);return Math.round(a/e.skills.length*10)/10}},actions:{async fetchSkills(){this.loading=!0,this.error=null;try{const e=await y.getSkills();e.success?this.skills=e.data.map(this.transformBackendSkill):this.error=e.message}catch(e){this.error=e instanceof Error?e.message:"獲取技能失敗",console.error("Failed to fetch skills:",e)}finally{this.loading=!1}},async createSkill(e){this.loading=!0,this.error=null;try{const a={name:e.name,description:e.description,level:1},t=await y.createSkill(a);if(t.success){const n=this.transformBackendSkill(t.data);return n.category=e.category,this.skills.push(n),n}else throw this.error=t.message,new Error(t.message)}catch(a){throw this.error=a instanceof Error?a.message:"創建技能失敗",console.error("Failed to create skill:",a),a}finally{this.loading=!1}},addSkillExperience(e,a){const t=this.skills.find(n=>n.id===e);if(t)for(t.experience+=a;t.experience>=t.maxExperience&&t.level<5;)t.experience-=t.maxExperience,t.level+=1,t.maxExperience=this.calculateMaxExperience(t.level),console.log(`${t.name} 升級到 ${t.level} 級！`)},transformBackendSkill(e){const a=Math.min(5,Math.max(1,e.level||1)),t=Math.floor((e.progress||0)*1e3);return{id:e.id||"",name:e.name||"",category:this.inferCategory(e.name),level:a,experience:t,maxExperience:this.calculateMaxExperience(a),icon:this.getSkillIcon(e.name),description:e.description}},inferCategory(e){const a=["程式","程序","python","javascript","設計","開發","技術","ai","資料"],t=e.toLowerCase();for(const n of a)if(t.includes(n))return"technical";return"soft"},getSkillIcon(e){const a={python:"🐍",javascript:"🟨",程式:"💻",設計:"🎨",溝通:"💬",時間管理:"⏰",領導:"👑"},t=e.toLowerCase();for(const[n,u]of Object.entries(a))if(t.includes(n))return u;return"⭐"},calculateMaxExperience(e){return e*200+100},clearSkills(){this.skills=[]},async addSampleSkills(){const e=[{name:"Python 程式設計",description:"學習 Python 程式語言",category:"technical"},{name:"時間管理",description:"提升時間規劃能力",category:"soft"},{name:"UI/UX 設計",description:"使用者介面和體驗設計",category:"technical"},{name:"溝通協作",description:"提升團隊合作效率",category:"soft"}];for(const a of e)try{await this.createSkill(a)}catch(t){console.error("Failed to create sample skill:",t)}}}}),R=M("chat",{state:()=>({messages:[],loading:!1,error:null,coachStyle:"gentle"}),getters:{lastMessage:e=>e.messages[e.messages.length-1],userMessages:e=>e.messages.filter(a=>a.role==="user"),coachMessages:e=>e.messages.filter(a=>a.role==="coach"),conversationCount:e=>e.messages.length},actions:{async fetchChatHistory(){this.loading=!0,this.error=null;try{const e=await y.getChatMessages();e.success?this.messages=e.data.map(this.transformBackendMessage):this.error=e.message}catch(e){this.error=e instanceof Error?e.message:"獲取聊天記錄失敗",console.error("Failed to fetch chat history:",e)}finally{this.loading=!1}},async sendMessage(e){if(!e.trim())return;this.loading=!0,this.error=null;const a={id:this.generateMessageId(),role:"user",content:e.trim(),timestamp:new Date};this.messages.push(a);try{const t=await y.sendMessage(e);if(t.success){const n=this.transformBackendMessage(t.data);return this.messages.push(n),n}else throw this.error=t.message,new Error(t.message)}catch(t){this.error=t instanceof Error?t.message:"發送訊息失敗",console.error("Failed to send message:",t);const n={id:this.generateMessageId(),role:"coach",content:"抱歉，我現在無法回應。請稍後再試。",timestamp:new Date};throw this.messages.push(n),t}finally{this.loading=!1}},setCoachStyle(e){this.coachStyle=e},clearMessages(){this.messages=[]},transformBackendMessage(e){return{id:e.id||this.generateMessageId(),role:this.mapBackendRole(e.role),content:e.content||"",timestamp:e.created_at?new Date(e.created_at):new Date}},mapBackendRole(e){switch(e){case"user":return"user";case"assistant":return"coach";default:return"coach"}},generateMessageId(){return`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`},getGreetingMessage(){const e={gentle:"你好！我是你的成長夥伴，有什麼可以幫助你的嗎？",challenging:"準備好迎接挑戰了嗎？讓我們一起突破極限！",creative:"嗨！讓我們用創意的方式探索你的潛能吧！"};return{id:this.generateMessageId(),role:"coach",content:e[this.coachStyle],timestamp:new Date}},addSystemMessage(e){const a={id:this.generateMessageId(),role:"coach",content:e,timestamp:new Date};this.messages.push(a)},async initializeChat(){if(this.messages.length===0&&(await this.fetchChatHistory(),this.messages.length===0)){const e=this.getGreetingMessage();this.messages.push(e)}},getSuggestedQuestions(){return["我該如何開始學習新技能？","如何提升我的專注力？","給我一些今天的任務建議","我感到有點迷茫，該怎麼辦？","如何平衡工作和學習？"]}}}),Q={class:"p-4 max-w-4xl mx-auto"},W=["disabled"],q={class:"mb-6 p-4 bg-gray-50 rounded-lg"},J={class:"space-y-3"},Y=["disabled"],Z={key:0,class:"text-red-600 text-sm"},ee={key:1,class:"mt-3"},se={class:"text-sm bg-white p-2 rounded border mt-1"},te={class:"mb-6 p-4 bg-gray-50 rounded-lg"},ae={class:"space-y-3"},re=["disabled"],oe={key:0,class:"text-red-600 text-sm"},ne={key:1,class:"mt-3"},ie={class:"font-medium"},le={class:"grid grid-cols-1 md:grid-cols-2 gap-2 mt-2"},ce={class:"flex justify-between items-start"},de={class:"font-medium text-sm"},ge={class:"text-xs text-gray-600 mt-1"},ue={class:"flex gap-2 mt-2 text-xs"},he={class:"px-2 py-1 bg-blue-100 rounded"},me={class:"px-2 py-1 bg-yellow-100 rounded"},pe={class:"px-2 py-1 bg-green-100 rounded"},ye=["onClick"],fe={class:"mb-6 p-4 bg-gray-50 rounded-lg"},_e={class:"space-y-3"},xe=["disabled"],be={key:0,class:"text-red-600 text-sm"},ve={key:1,class:"mt-3"},ke={class:"font-medium"},we={class:"grid grid-cols-1 md:grid-cols-3 gap-2 mt-2"},Se={class:"flex items-center gap-2 mb-2"},Ce={class:"text-lg"},Me={class:"font-medium text-sm"},Ee={class:"text-xs text-gray-600"},Ie={class:"w-full bg-gray-200 rounded-full h-2 mt-1"},Te={class:"mt-1"},De={class:"mb-6 p-4 bg-gray-50 rounded-lg"},$e={class:"space-y-3"},Be=["disabled"],Fe={class:"flex gap-2"},Pe=["disabled"],Ae={key:0,class:"text-red-600 text-sm"},Ue={key:1,class:"mt-3"},Le={class:"font-medium"},Ge={class:"mt-2 bg-white rounded border p-3 max-h-64 overflow-y-auto"},je={class:"flex items-start gap-2"},ze={class:"flex-1"},Ve={class:"text-sm"},He={class:"text-xs text-gray-500 mt-1"},Ke=U({__name:"ApiTestPage",setup(e){const a=L(),t=G(),n=O(),u=R(),_=x(!1),f=x({success:!1,message:"尚未測試連接"}),k=x([]),m=x("");async function w(){_.value=!0;try{const i=await y.healthCheck();f.value={success:i.success,message:i.success?`✅ ${i.message}`:`❌ ${i.message}`}}catch(i){f.value={success:!1,message:`❌ 連接失敗: ${i instanceof Error?i.message:"未知錯誤"}`}}finally{_.value=!1}}async function S(){try{const i=await y.getUsers();i.success&&(k.value=i.data)}catch(i){console.error("Failed to get users:",i)}}async function E(){try{const i={name:`測試用戶_${Date.now()}`,email:`test_${Date.now()}@example.com`};await a.createUser(i),await S()}catch(i){console.error("Failed to create user:",i)}}async function I(){await t.fetchTasks()}async function T(){try{await t.createTask({title:`測試任務_${Date.now()}`,description:"這是一個API測試任務",type:"side",difficulty:3})}catch(i){console.error("Failed to create task:",i)}}async function D(){await n.fetchSkills()}async function $(){try{await n.createSkill({name:`測試技能_${Date.now()}`,description:"這是一個API測試技能",category:"technical"})}catch(i){console.error("Failed to create skill:",i)}}async function B(){await u.fetchChatHistory()}async function C(){if(m.value.trim())try{await u.sendMessage(m.value),m.value=""}catch(i){console.error("Failed to send message:",i)}}function F(i){switch(i){case"pending":return"bg-yellow-100 text-yellow-800";case"in_progress":return"bg-blue-100 text-blue-800";case"completed":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}}function P(i){switch(i){case"pending":return"待辦";case"in_progress":return"進行中";case"completed":return"已完成";default:return"未知"}}function A(i){return new Date(i).toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit"})}return j(()=>{w()}),(i,c)=>(g(),d("div",Q,[z(V,{title:"API 測試頁面"}),s("div",{class:p(["mb-6 p-4 rounded-lg",f.value.success?"bg-green-100":"bg-red-100"])},[c[3]||(c[3]=s("h2",{class:"text-lg font-semibold mb-2"},"🔗 後端連接狀態",-1)),s("p",{class:p(["text-sm",f.value.success?"text-green-700":"text-red-700"])},o(f.value.message),3),s("button",{onClick:w,disabled:_.value,class:"mt-2 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50"},o(_.value?"測試中...":"測試連接"),9,W)],2),s("div",q,[c[5]||(c[5]=s("h2",{class:"text-lg font-semibold mb-3"},"👤 用戶 API 測試",-1)),s("div",J,[s("button",{onClick:S,disabled:l(a).loading,class:"btn-primary"},o(l(a).loading?"載入中...":"獲取用戶列表"),9,Y),s("button",{onClick:E,class:"btn-secondary ml-2"}," 創建測試用戶 "),l(a).error?(g(),d("div",Z," 錯誤："+o(l(a).error),1)):h("",!0),k.value.length>0?(g(),d("div",ee,[c[4]||(c[4]=s("h3",{class:"font-medium"},"用戶列表：",-1)),s("ul",se,[(g(!0),d(b,null,v(k.value,r=>(g(),d("li",{key:r.id,class:"py-1"}," ID: "+o(r.id)+" | 姓名: "+o(r.name),1))),128))])])):h("",!0)])]),s("div",te,[c[6]||(c[6]=s("h2",{class:"text-lg font-semibold mb-3"},"✅ 任務 API 測試",-1)),s("div",ae,[s("button",{onClick:I,disabled:l(t).loading,class:"btn-primary"},o(l(t).loading?"載入中...":"獲取任務列表"),9,re),s("button",{onClick:T,class:"btn-secondary ml-2"}," 創建測試任務 "),s("button",{onClick:c[0]||(c[0]=r=>l(t).addSampleTasks()),class:"btn-secondary ml-2"}," 添加示例任務 "),l(t).error?(g(),d("div",oe," 錯誤："+o(l(t).error),1)):h("",!0),l(t).tasks.length>0?(g(),d("div",ne,[s("h3",ie,"任務列表 ("+o(l(t).tasks.length)+" 個)：",1),s("div",le,[(g(!0),d(b,null,v(l(t).tasks,r=>(g(),d("div",{key:r.id,class:p(["p-3 bg-white rounded border",r.status==="completed"?"border-green-300":"border-gray-200"])},[s("div",ce,[s("div",null,[s("h4",de,o(r.title),1),s("p",ge,o(r.description),1),s("div",ue,[s("span",he,o(r.type),1),s("span",me,o(r.difficulty)+"⭐",1),s("span",pe,"+"+o(r.experience)+" EXP",1)])]),s("button",{onClick:Xe=>l(t).toggleTaskStatus(r.id),class:p(["text-xs px-2 py-1 rounded",F(r.status)])},o(P(r.status)),11,ye)])],2))),128))])])):h("",!0)])]),s("div",fe,[c[7]||(c[7]=s("h2",{class:"text-lg font-semibold mb-3"},"🌳 技能 API 測試",-1)),s("div",_e,[s("button",{onClick:D,disabled:l(n).loading,class:"btn-primary"},o(l(n).loading?"載入中...":"獲取技能列表"),9,xe),s("button",{onClick:$,class:"btn-secondary ml-2"}," 創建測試技能 "),s("button",{onClick:c[1]||(c[1]=r=>l(n).addSampleSkills()),class:"btn-secondary ml-2"}," 添加示例技能 "),l(n).error?(g(),d("div",be," 錯誤："+o(l(n).error),1)):h("",!0),l(n).skills.length>0?(g(),d("div",ve,[s("h3",ke,"技能列表 ("+o(l(n).skills.length)+" 個)：",1),s("div",we,[(g(!0),d(b,null,v(l(n).skills,r=>(g(),d("div",{key:r.id,class:"p-3 bg-white rounded border"},[s("div",Se,[s("span",Ce,o(r.icon),1),s("div",null,[s("h4",Me,o(r.name),1),s("span",{class:p(["text-xs px-2 py-1 rounded",r.category==="technical"?"bg-blue-100":"bg-green-100"])},o(r.category),3)])]),s("div",Ee,[s("p",null,"等級: "+o(r.level)+"/5",1),s("div",Ie,[s("div",{class:"bg-blue-600 h-2 rounded-full transition-all",style:X({width:r.experience/r.maxExperience*100+"%"})},null,4)]),s("p",Te,o(r.experience)+"/"+o(r.maxExperience)+" EXP",1)])]))),128))])])):h("",!0)])]),s("div",De,[c[8]||(c[8]=s("h2",{class:"text-lg font-semibold mb-3"},"🤖 AI 教練測試",-1)),s("div",$e,[s("button",{onClick:B,disabled:l(u).loading,class:"btn-primary"},o(l(u).loading?"載入中...":"獲取聊天記錄"),9,Be),s("div",Fe,[H(s("input",{"onUpdate:modelValue":c[2]||(c[2]=r=>m.value=r),onKeyup:N(C,["enter"]),class:"flex-1 px-3 py-2 border rounded-lg",placeholder:"輸入測試訊息..."},null,544),[[K,m.value]]),s("button",{onClick:C,disabled:!m.value.trim()||l(u).loading,class:"btn-primary"}," 發送 ",8,Pe)]),l(u).error?(g(),d("div",Ae," 錯誤："+o(l(u).error),1)):h("",!0),l(u).messages.length>0?(g(),d("div",Ue,[s("h3",Le,"聊天記錄 ("+o(l(u).messages.length)+" 條)：",1),s("div",Ge,[(g(!0),d(b,null,v(l(u).messages,r=>(g(),d("div",{key:r.id,class:"mb-3 last:mb-0"},[s("div",je,[s("span",{class:p(["text-sm px-2 py-1 rounded",r.role==="user"?"bg-blue-100":"bg-gray-100"])},o(r.role==="user"?"👤":"🤖"),3),s("div",ze,[s("p",Ve,o(r.content),1),s("p",He,o(A(r.timestamp)),1)])])]))),128))])])):h("",!0)])])]))}}),Ne=(e,a)=>{const t=e.__vccOpts||e;for(const[n,u]of a)t[n]=u;return t},Re=Ne(Ke,[["__scopeId","data-v-cb213029"]]);export{Re as default};
