import{d as P,l as V,r as p,c as u,m as j,a,g as M,i,_ as z,b as e,t as n,n as q,F as k,e as w,j as D,f as x,q as f,o}from"./index-BETfxjSh.js";const L={class:"min-h-screen bg-primary-50"},X={key:0,class:"px-4 py-8 text-center"},A={key:1,class:"px-4 py-4"},G={class:"bg-red-50 border border-red-200 rounded-lg p-4"},H={class:"flex items-center"},I={class:"text-red-600 text-sm mt-1"},J={key:2,class:"px-4 py-4 space-y-4"},K={key:0,class:"bg-white rounded-lg p-4 shadow-sm"},O={class:"grid grid-cols-3 gap-4 text-center text-sm"},Q={class:"block font-medium text-orange-600"},R={class:"block font-medium text-blue-600"},U={class:"block font-medium text-green-600"},W={class:"w-full bg-gray-200 rounded-full h-2 mt-4"},Y={class:"text-center text-sm text-gray-600 mt-2"},Z={key:1,class:"bg-white rounded-lg p-4 shadow-sm"},ee={class:"flex space-x-2"},te=["onClick"],se={class:"space-y-3"},le={class:"flex justify-between items-start"},re={class:"flex-1"},ne={class:"font-medium text-gray-900"},ae={key:0,class:"text-gray-600 text-sm mt-1"},oe={class:"flex items-center space-x-4 mt-3 text-xs text-gray-500"},de={class:"flex items-center"},ie={class:"flex items-center"},ue={key:0,class:"flex items-center"},ce={class:"ml-4"},ge=["onClick"],pe={key:2,class:"text-center py-12"},be=P({__name:"SubtasksPage",setup(ve){const v=V(),r=p([]),c=p(!1),d=p(null),g=p("all"),C=[{value:"all",label:"全部"},{value:"pending",label:"待處理"},{value:"in_progress",label:"進行中"},{value:"completed",label:"已完成"},{value:"paused",label:"已暫停"}],S=u(()=>{if(g.value==="all")return r.value;const s={pending:"pending",in_progress:"in_progress",completed:"completed",paused:"paused"};return r.value.filter(t=>t.status===s[g.value])}),T=u(()=>r.value.filter(s=>s.status==="pending").length),B=u(()=>r.value.filter(s=>s.status==="in_progress").length),m=u(()=>r.value.filter(s=>s.status==="completed").length),y=u(()=>r.value.length===0?0:Math.round(m.value/r.value.length*100)),h=async()=>{c.value=!0,d.value=null;try{const s=await D.getTasks();if(s.success){const t=s.data.map(v.transformBackendTask);r.value=t.filter(l=>l.parent_task_id)}else d.value=s.message}catch(s){d.value=s instanceof Error?s.message:"載入子任務失敗",console.error("Failed to load subtasks:",s)}finally{c.value=!1}},F=async s=>{try{await v.toggleTaskStatus(s);const t=r.value.findIndex(l=>l.id===s);if(t!==-1){const l=v.tasks.find(b=>b.id===s);l&&(r.value[t]={...l})}}catch(t){d.value=t instanceof Error?t.message:"更新子任務狀態失敗",console.error("Failed to toggle subtask status:",t)}},_=()=>{h()},$=s=>{switch(s){case"pending":return"border-orange-400";case"in_progress":return"border-blue-400";case"completed":return"border-green-400";case"paused":return"border-gray-400";case"cancelled":return"border-red-400";default:return"border-gray-200"}},E=s=>{switch(s){case"pending":return"bg-orange-100 text-orange-800 hover:bg-orange-200";case"in_progress":return"bg-blue-100 text-blue-800 hover:bg-blue-200";case"completed":return"bg-green-100 text-green-800 hover:bg-green-200";case"paused":return"bg-gray-100 text-gray-800 hover:bg-gray-200";case"cancelled":return"bg-red-100 text-red-800 hover:bg-red-200";default:return"bg-gray-100 text-gray-800 hover:bg-gray-200"}},N=s=>{switch(s){case"pending":return"開始";case"in_progress":return"完成";case"completed":return"已完成";case"paused":return"繼續";case"cancelled":return"已取消";default:return"未知"}};return j(async()=>{await h()}),(s,t)=>(o(),a("div",L,[M(z,{title:"子任務"}),c.value?(o(),a("div",X,t[1]||(t[1]=[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),e("p",{class:"mt-2 text-gray-600"},"載入子任務中...",-1)]))):d.value?(o(),a("div",A,[e("div",G,[e("div",H,[t[3]||(t[3]=e("div",{class:"text-red-600 mr-3"},"⚠️",-1)),e("div",null,[t[2]||(t[2]=e("h3",{class:"text-red-800 font-medium"},"載入失敗",-1)),e("p",I,n(d.value),1)])]),e("button",{onClick:_,class:"mt-3 px-4 py-2 bg-red-600 text-white rounded-lg text-sm hover:bg-red-700 transition-colors"}," 重試 ")])])):(o(),a("div",J,[r.value.length>0?(o(),a("div",K,[e("div",O,[e("div",null,[t[4]||(t[4]=e("span",{class:"block text-gray-600"},"待處理",-1)),e("span",Q,n(T.value),1)]),e("div",null,[t[5]||(t[5]=e("span",{class:"block text-gray-600"},"進行中",-1)),e("span",R,n(B.value),1)]),e("div",null,[t[6]||(t[6]=e("span",{class:"block text-gray-600"},"已完成",-1)),e("span",U,n(m.value),1)])]),e("div",W,[e("div",{class:"bg-green-600 h-2 rounded-full transition-all duration-300",style:q({width:y.value+"%"})},null,4)]),e("p",Y,n(m.value)+"/"+n(r.value.length)+" 完成 ("+n(y.value)+"%) ",1)])):i("",!0),r.value.length>0?(o(),a("div",Z,[e("div",ee,[(o(),a(k,null,w(C,l=>e("button",{key:l.value,onClick:b=>g.value=l.value,class:x(["px-3 py-1 rounded-full text-sm transition-colors",g.value===l.value?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"])},n(l.label),11,te)),64))])])):i("",!0),e("div",se,[(o(!0),a(k,null,w(S.value,l=>(o(),a("div",{key:l.id,class:x(["bg-white rounded-lg p-4 shadow-sm border-l-4",$(l.status)])},[e("div",le,[e("div",re,[e("h3",ne,n(l.title),1),l.description?(o(),a("p",ae,n(l.description),1)):i("",!0),e("div",oe,[e("span",de,[t[7]||(t[7]=e("span",{class:"w-2 h-2 bg-yellow-400 rounded-full mr-1"},null,-1)),f(" 難度 "+n(l.difficulty)+"/5 ",1)]),e("span",ie,[t[8]||(t[8]=e("span",{class:"w-2 h-2 bg-green-400 rounded-full mr-1"},null,-1)),f(" "+n(l.experience)+" EXP ",1)]),l.task_order?(o(),a("span",ue,[t[9]||(t[9]=e("span",{class:"w-2 h-2 bg-purple-400 rounded-full mr-1"},null,-1)),f(" 順序 "+n(l.task_order),1)])):i("",!0)])]),e("div",ce,[e("button",{onClick:b=>F(l.id),class:x([E(l.status),"px-3 py-1 rounded text-sm font-medium transition-colors"])},n(N(l.status)),11,ge)])])],2))),128))]),r.value.length===0?(o(),a("div",pe,[t[10]||(t[10]=e("div",{class:"text-6xl mb-4"},"📋",-1)),t[11]||(t[11]=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"還沒有子任務",-1)),t[12]||(t[12]=e("p",{class:"text-gray-600 mb-4"},"開始一個大任務來生成子任務吧！",-1)),e("button",{onClick:t[0]||(t[0]=l=>s.$router.push("/tasks")),class:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"}," 前往任務頁面 ")])):i("",!0)])),!c.value&&r.value.length>0?(o(),a("button",{key:3,onClick:_,class:"fixed bottom-20 right-4 w-12 h-12 bg-blue-600 text-white rounded-full shadow-lg hover:bg-blue-700 transition-colors flex items-center justify-center",title:"刷新子任務"}," 🔄 ")):i("",!0)]))}});export{be as default};
